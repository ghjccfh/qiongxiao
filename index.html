<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"><link rel="icon" href="data:,"><title>云阙琼霄</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link rel="stylesheet" href="style.css?v=1.0.0"><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script></head><body><div class="admin-panel-drawer" id="adminPanelDrawer" style="display: none;"><button id="resetSystemBtn" class="action-btn" style="background: rgba(231, 76, 60, 0.2); color: #e74c3c;"><i class="fas fa-bomb"></i> 清空系统数据</button><button class="admin-toggle-btn" id="adminPanelToggle"><i class="fas fa-cog"></i> 管理面板 <i class="fas fa-chevron-left" id="adminPanelIcon"></i></button><div class="admin-panel-content" id="adminPanelContent"><div class="admin-panel-section"><h4 class="admin-panel-title"><i class="fas fa-users"></i> 用户管理</h4><div class="admin-panel-buttons"><button class="admin-panel-btn" id="panelModifyCoinsBtn"><i class="fas fa-coins"></i> 修改用户金币 </button><button class="admin-panel-btn" id="panelApproveUsersBtn"><i class="fas fa-user-check"></i> 审批注册用户 </button></div></div><div class="admin-panel-section" id="adminPanelItemsSection" style="display: none;"><h4 class="admin-panel-title"><i class="fas fa-gift"></i> 物品管理</h4><div class="admin-panel-buttons"><button class="admin-panel-btn" id="panelAddItemBtn"><i class="fas fa-plus-circle"></i> 添加新物品 </button><button class="admin-panel-btn" id="panelResetItemsBtn"><i class="fas fa-redo"></i> 重置物品数量 </button><button class="admin-panel-btn" id="panelResetDefaultBtn"><i class="fas fa-sync-alt"></i> 重置为默认 </button></div></div><div class="admin-panel-section" id="adminPanelBoxesSection" style="display: none;"><h4 class="admin-panel-title"><i class="fas fa-box-open"></i> 盲盒管理</h4><div class="admin-panel-buttons"><button class="admin-panel-btn" id="panelResetUnopenedBtn"><i class="fas fa-redo-alt"></i></button><div class="value-reset-container"><div class="value-reset-input-group"><input type="number" class="value-reset-input" id="targetValueInput" placeholder="目标价值 (如 4000)" min="0" max="100000"><button class="value-reset-btn" id="panelResetByValueBtn"><i class="fas fa-calculator"></i></button></div><div style="font-size: 0.8rem; color: rgba(255, 215, 0, 0.7); text-align: center;"> 目标价值允许±10%偏差 </div></div></div></div><div class="admin-panel-section" id="adminPanelHistorySection" style="display: none;"><h4 class="admin-panel-title"><i class="fas fa-history"></i> 记录管理</h4><div class="admin-panel-buttons"><button class="admin-panel-btn" id="panelRefreshHistoryBtn"><i class="fas fa-sync"></i> 刷新记录 </button><button class="admin-panel-btn" id="panelClearHistoryBtn"><i class="fas fa-trash"></i> 清空记录 </button></div></div><div class="admin-panel-section"><h4 class="admin-panel-title"><i class="fas fa-eye"></i> 查看仓库</h4><div class="admin-panel-buttons"><button class="admin-panel-btn" id="panelViewWarehouseBtn"><i class="fas fa-search"></i> 查看用户仓库 </button></div></div></div></div><nav class="navbar"><a href="#" class="logo"><i class="fas fa-gem"></i> 云阙琼霄 </a><ul class="nav-links"><li><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i> 首页</a></li><li><a href="#" class="nav-link" data-page="warehouse"><i class="fas fa-warehouse"></i> 个人仓库</a></li><li><a href="#" class="nav-link" data-page="history"><i class="fas fa-history"></i> 开盒记录</a></li><li><a href="#" class="nav-link" data-page="profile"><i class="fas fa-user-edit"></i> 个人资料</a></li><li><a href="#" class="nav-link" data-page="chat"><i class="fas fa-comments"></i> 用户中心 <span class="chat-badge" id="chatUnreadBadge">0</span></a></li><li id="admin-link" style="display: none;"><a href="#" class="nav-link" data-page="admin"><i class="fas fa-cog"></i> 后台管理</a></li></ul><div class="user-info"><div id="user-logged-out"><button class="login-btn" id="loginModalBtn"><i class="fas fa-sign-in-alt"></i> 用户登录</button><button class="login-btn" id="registerModalBtn" style="background: linear-gradient(90deg, #3498db, #2980b9); margin-left: 10px;"><i class="fas fa-user-plus"></i> 注册账号 </button></div><div id="user-logged-in" style="display: none;"><div class="user-avatar" id="userAvatar">U</div><div><div id="userName">用户</div><div class="admin-badge" id="adminBadge" style="display: none;">管理员</div><div class="subadmin-badge" id="subadminBadge" style="display: none;">管理员</div></div><button class="login-btn" id="logoutBtn" style="padding: 8px 15px; font-size: 0.9rem;">登出</button></div></div></nav><div class="main-container"><div class="sidebar" id="sidebar"><h2 class="sidebar-title"><i class="fas fa-user-circle"></i> 用户中心</h2><div class="user-profile"><div class="profile-avatar" id="profileAvatar">U</div><div class="profile-info"><h3 id="profileName">未登录</h3><p id="profileEmail">请先登录</p><p id="profileRole" style="font-size: 0.8rem; color: #FFD700;"></p><p id="profileApprovalStatus" style="font-size: 0.7rem; color: rgba(255, 215, 0, 0.7); display: none;"></p></div></div><div class="sidebar-section" id="user-stats-section"><h3 class="section-title"><i class="fas fa-chart-line"></i> 我的统计</h3><div class="stats-grid"><div class="stat-row"><div class="stat-item"><div class="stat-icon"><i class="fas fa-coins"></i></div><div class="stat-content"><div class="stat-value" id="userBalance">0</div><div class="stat-label">金币余额</div></div></div></div><div class="stat-row"><div class="stat-item"><div class="stat-icon"><i class="fas fa-box-open"></i></div><div class="stat-content"><div class="stat-value" id="userBoxesOpened">0</div><div class="stat-label">开盒总数</div></div></div></div><div class="stat-row"><div class="stat-item"><div class="stat-icon"><i class="fas fa-warehouse"></i></div><div class="stat-content"><div class="stat-value" id="userWarehouse">0</div><div class="stat-label">仓库物品</div></div></div></div><div class="stat-row"><div class="stat-item"><div class="stat-icon"><i class="fas fa-level-up-alt"></i></div><div class="stat-content"><div class="stat-value" id="userLevel">1</div><div class="stat-label">用户等级</div></div></div></div></div></div><div class="sidebar-section"><ul class="sidebar-menu"><li id="admin-menu-item" style="display: none;"><a href="#" class="sidebar-menu-item" data-page="admin"><i class="fas fa-cog"></i> 后台管理</a></li></ul></div></div><div class="content"><div class="content-section active" id="home-section"><h1 class="page-title">云阙琼霄战队福利 </h1><p class="page-subtitle">点击宝藏开启，每次开启都有惊喜！全部开启后自动重置</p><div id="loginRequired" class="login-restriction" style="display: none;"><i class="fas fa-lock"></i><h3>请先登录账户</h3><p>只有登录用户才能使用。请注册或联系管理员获取账号。</p><div style="margin-top: 20px;"><button class="login-btn" id="loginFromHome" style="margin-right: 15px;">立即登录</button><button class="login-btn" id="registerFromHome" style="background: linear-gradient(90deg, #3498db, #2980b9);">注册账号</button></div></div><div id="adminHomeStats" class="admin-home-stats" style="display: none;"><div class="admin-home-stat"><div class="admin-home-stat-value" id="adminTotalUsersHome">0</div><div class="admin-home-stat-label">总用户数</div></div><div class="admin-home-stat"><div class="admin-home-stat-value" id="adminOpenedBoxesHome">0</div><div class="admin-home-stat-label">已开启盲盒</div></div><div class="admin-home-stat"><div class="admin-home-stat-value" id="adminRemainingBoxesHome">50</div><div class="admin-home-stat-label">剩余盲盒</div></div><div class="admin-home-stat"><div class="admin-home-stat-value" id="adminRoundProgressHome">0%</div><div class="admin-home-stat-label">本轮进度</div></div><div class="admin-home-stat"><div class="admin-home-stat-value" id="adminTotalValueHome">0</div><div class="admin-home-stat-label">盲盒总价值</div></div><div class="admin-home-stat"><div class="admin-home-stat-value" id="adminRemainingValueHome">0</div><div class="admin-home-stat-label">剩余价值</div></div></div><div id="adminBoxesPreview" class="admin-boxes-preview" style="display: none;"><h3 class="admin-boxes-title"><i class="fas fa-eye"></i> 管理员预览</h3><p class="admin-boxes-info"> 作为管理员，您可以查看每个盲盒的预设奖品。鼠标悬停在盲盒上可查看详细信息。<br> 灰色盒子表示已被开启，彩色盒子表示尚未开启。<br><strong>管理员可以点击未开启的盒子查看奖品详情并更换奖品。</strong></p></div><div id="gameArea" class="game-area" style="display: none;"><div class="blind-box-stats"><div class="blind-box-stat"><div class="stat-label">已开启盲盒</div><div class="stat-value" id="openedBoxesCount">0</div></div><div class="blind-box-stat"><div class="stat-label">剩余盲盒</div><div class="stat-value" id="remainingBoxesCount">50</div></div><div class="blind-box-stat"><div class="stat-label">本轮进度</div><div class="stat-value" id="roundProgress">0%</div></div><div class="blind-box-stat"><p style="color: rgba(255, 215, 0, 0.8); font-size: 0.9rem;">全部开启后自动重置</p></div></div><div class="blind-boxes-grid" id="blindBoxesGrid"></div><div class="result-area" id="resultArea"><h2 class="result-title"><i class="fas fa-gift"></i> 恭喜获得！</h2><div id="resultContent"></div></div></div></div><div class="content-section" id="warehouse-section"><h1 class="page-title">个人仓库</h1><p class="page-subtitle">已收集 <span id="warehouseCount">0</span> 个独特物品 | 总价值 <span id="warehouseTotalValue">0</span> 金币</p><div id="warehouseLoginRequired" class="login-restriction" style="display: none;"><i class="fas fa-lock"></i><h3>请先登录账户</h3><p>只有登录用户才能查看个人仓库。请注册或联系管理员获取账号。</p><div style="margin-top: 20px;"><button class="login-btn" id="loginFromWarehouse" style="margin-right: 15px;">立即登录</button><button class="login-btn" id="registerFromWarehouse" style="background: linear-gradient(90deg, #3498db, #2980b9);">注册账号</button></div></div><div id="adminWarehouseRestriction" class="login-restriction" style="display: none;"><i class="fas fa-user-shield"></i><h3>管理员权限限制</h3><p>管理员账户不参与游戏，没有个人仓库。</p><div style="margin-top: 20px;"><button class="login-btn" id="gotoAdminFromWarehouseBtn" style="margin-right: 15px;"><i class="fas fa-cog"></i> 前往后台管理</button><button class="login-btn" id="logoutForWarehouseBtn" style="background: linear-gradient(90deg, #3498db, #2980b9);"><i class="fas fa-sign-out-alt"></i> 切换账户</button></div></div><div class="warehouse-container" id="warehouseContainer" style="display: none;"><div class="warehouse-total"><div class="warehouse-total-value" id="warehouseTotalGold">0</div><div class="warehouse-total-label">可兑换金币总额</div></div><div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;"><button class="warehouse-redeem-all-btn" id="redeemAllBtn" disabled><i class="fas fa-coins"></i> 一键兑换全部物品 </button><button class="warehouse-redeem-all-btn" id="redeemSelectedBtn" style="background: linear-gradient(90deg, #3498db, #2980b9);" disabled><i class="fas fa-check-circle"></i> 兑换选中物品 </button></div><div id="warehouseItemsList"></div></div></div><div class="content-section" id="history-section"><h1 class="page-title">全局开盒记录</h1><p class="page-subtitle">查看所有用户的开盒历史记录，您自己的记录会高亮显示</p><div id="historyLoginRequired" class="login-restriction" style="display: none;"><i class="fas fa-lock"></i><h3>请先登录账户</h3><p>只有登录用户才能查看开盒记录。请注册或联系管理员获取账号。</p><div style="margin-top: 20px;"><button class="login-btn" id="loginFromHistory" style="margin-right: 15px;">立即登录</button><button class="login-btn" id="registerFromHistory" style="background: linear-gradient(90deg, #3498db, #2980b9);">注册账号</button></div></div><div class="history-container" id="historyContainer" style="display: none;"><div class="data-table-wrapper"><table class="data-table"><thead><tr><th>时间</th><th>物品名称</th><th>物品价值</th><th>稀有度</th><th>开盒用户</th></tr></thead><tbody id="historyTableBody"></tbody></table></div></div></div><div class="content-section" id="profile-section"><h1 class="page-title">个人资料</h1><p class="page-subtitle">管理您的账户信息</p><div id="profileLoginRequired" class="login-restriction" style="display: none;"><i class="fas fa-lock"></i><h3>请先登录账户</h3><p>只有登录用户才能管理个人资料。请注册或联系管理员获取账号。</p><div style="margin-top: 20px;"><button class="login-btn" id="loginFromProfile" style="margin-right: 15px;">立即登录</button><button class="login-btn" id="registerFromProfile" style="background: linear-gradient(90deg, #3498db, #2980b9);">注册账号</button></div></div><div class="form-container" id="profileForm" style="display: none;"><div class="form-group"><label class="form-label">用户名</label><input type="text" class="form-input" id="profileUsername" placeholder="用户名" readonly></div><div class="form-group"><label class="form-label">电子邮箱</label><input type="email" class="form-input" id="profileEmailInput" placeholder="电子邮箱"></div><div class="form-group"><label class="form-label">新密码（留空不修改）</label><input type="password" class="form-input" id="profilePassword" placeholder="新密码"></div><div class="form-group"><label class="form-label">确认新密码</label><input type="password" class="form-input" id="profilePasswordConfirm" placeholder="确认新密码"></div><button class="form-submit" id="updateProfileBtn">更新资料</button></div></div><div class="content-section" id="chat-section"><h1 class="page-title"><i class="fas fa-comments"></i> 在线玩家·聊天室</h1><div id="chatLoginRequired" class="login-restriction" style="display: none;"><i class="fas fa-lock"></i><h3>请先登录账户</h3><p>登录后即可参与聊天，查看在线玩家。</p><div style="margin-top: 20px;"><button class="login-btn" id="loginFromChat" style="margin-right: 15px;">立即登录</button><button class="login-btn" id="registerFromChat" style="background: linear-gradient(90deg, #3498db, #2980b9);">注册账号</button></div></div><div id="chatContent" style="display: none;"><div class="chat-container"><div class="online-users-panel"><h3 style="color: gold; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;"><i class="fas fa-users"></i> 在线玩家 <span id="onlineCount" style="background: rgba(255,215,0,0.2); padding: 3px 12px; border-radius: 20px; font-size: 0.9rem;">0</span></h3><div id="onlineUsersList" style="display: flex; flex-direction: column; gap: 5px;"></div><p id="noOnlineUsers" style="color: rgba(255,215,0,0.6); text-align: center; padding: 20px; display: none;"><i class="fas fa-user-clock"></i> 暂无在线玩家 </p></div><div class="chat-main-panel"><div class="chat-messages-list" id="chatMessagesList"></div><div class="chat-input-area"><input type="text" class="chat-input" id="chatMessageInput" placeholder="说点什么..." autocomplete="off"><button class="chat-send-btn" id="sendChatMessageBtn"><i class="fas fa-paper-plane"></i> 发送 </button></div></div></div></div></div><div class="content-section" id="admin-section"><h1 class="page-title">后台管理系统</h1><p class="page-subtitle" id="adminSubtitle">管理员专用面板</p><div id="adminLoginRequired" class="login-restriction" style="display: none;"><i class="fas fa-lock"></i><h3>需要管理员权限</h3><p>只有管理员才能访问后台管理系统。</p><button class="login-btn" id="loginFromAdmin" style="margin-top: 20px;">立即登录</button></div><div id="adminContent" style="display: none;" class="admin-controls-hidden"><div class="dashboard-stats"><div class="dashboard-stat"><h3>总用户数</h3><div class="value" id="adminTotalUsers">0</div></div><div class="dashboard-stat"><h3>今日开盒数</h3><div class="value" id="adminTodayBoxes">0</div></div><div class="dashboard-stat"><h3>总物品数</h3><div class="value" id="adminTotalItems">0</div></div><div class="dashboard-stat"><h3>活跃用户</h3><div class="value" id="adminActiveUsers">0</div></div><div class="dashboard-stat consumption-stat"><h3><i class="fas fa-coins"></i> 总消耗金币</h3><div class="value" id="adminTotalSpentGold">0</div></div><div class="dashboard-stat profit-stat"><h3><i class="fas fa-gift"></i> 总开出价值</h3><div class="value" id="adminTotalObtainedValue">0</div></div><div class="dashboard-stat difference-stat"><h3><i class="fas fa-balance-scale"></i> 价值差值</h3><div class="value" id="adminValueDifference">0</div></div></div><div id="adminCoinOperationsSection" style="display: none; margin-top: 40px;"><h3 style="margin-bottom: 20px; color: #FFD700;"><i class="fas fa-coins"></i> 金币操作记录 </h3><div style="background: rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 20px; border: 2px solid rgba(255, 215, 0, 0.3);"><div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;"><div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;"><button class="reset-daily-btn admin-panel-control" id="clearCoinOperationsBtn" style="display: none; background: rgba(255, 71, 87, 0.2); color: #ff4757; border-color: #ff4757;"><i class="fas fa-trash"></i> 清除旧记录 </button><div style="color: rgba(255, 215, 0, 0.9);"> 总记录数: <span id="coinOperationsCount">0</span></div></div><div style="display: flex; gap: 10px; align-items: center;"><span style="color: rgba(255, 215, 0, 0.9); font-size: 0.9rem;">每页显示:</span><select class="form-select" id="coinOperationsPageSize" style="width: 80px; padding: 6px; font-size: 0.9rem;"><option value="20">20条</option><option value="50">50条</option><option value="100">100条</option></select></div></div><div style="display: flex; gap: 15px; margin-bottom: 20px; flex-wrap: wrap;"><div style="display: flex; align-items: center; gap: 10px;"><span style="color: rgba(255, 215, 0, 0.9);">筛选用户:</span><select class="form-select" id="coinOperationsFilterUser" style="width: 200px; padding: 8px;"><option value="">所有用户</option></select></div><div style="display: flex; align-items: center; gap: 10px;"><span style="color: rgba(255, 215, 0, 0.9);">操作类型:</span><select class="form-select" id="coinOperationsFilterType" style="width: 150px; padding: 8px;"><option value="">所有类型</option><option value="add">增加金币</option><option value="subtract">减少金币</option><option value="set">设置金币</option></select></div><div style="display: flex; align-items: center; gap: 10px;"><span style="color: rgba(255, 215, 0, 0.9);">日期:</span><select class="form-select" id="coinOperationsFilterDate" style="width: 150px; padding: 8px;"><option value="">所有日期</option><option value="today">今天</option><option value="yesterday">昨天</option><option value="week">本周</option><option value="month">本月</option></select></div></div><div class="data-table-wrapper" style="max-height: 500px; overflow-y: auto;"><table class="data-table"><thead><tr><th>操作时间</th><th>管理员</th><th>操作用户</th><th>操作类型</th><th>操作金额</th><th>原余额</th><th>新余额</th><th>备注</th></tr></thead><tbody id="coinOperationsTableBody"></tbody></table></div><div style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 20px;"><button class="action-btn" id="coinOperationsPrevPage" style="background: rgba(52, 152, 219, 0.2); color: #3498db; display: none;" disabled><i class="fas fa-chevron-left"></i> 上一页 </button><span style="color: rgba(255, 215, 0, 0.9);" id="coinOperationsPageInfo">第 1 页</span><button class="action-btn" id="coinOperationsNextPage" style="background: rgba(52, 152, 219, 0.2); color: #3498db; display: none;" disabled> 下一页 <i class="fas fa-chevron-right"></i></button></div><div style="margin-top: 20px; padding: 15px; background: rgba(0, 0, 0, 0.2); border-radius: 10px; border: 1px solid rgba(255, 215, 0, 0.2);"><h4 style="color: #FFD700; margin-bottom: 10px; font-size: 1rem;"><i class="fas fa-chart-bar"></i> 今日统计</h4><div style="display: flex; gap: 20px; flex-wrap: wrap;"><div style="color: rgba(255, 215, 0, 0.9);"><span>今日操作数:</span><span id="todayOperationsCount" style="color: #FFD700; font-weight: bold; margin-left: 5px;">0</span></div><div style="color: rgba(255, 215, 0, 0.9);"><span>今日增加总额:</span><span id="todayAddTotal" style="color: #2ecc71; font-weight: bold; margin-left: 5px;">0</span></div><div style="color: rgba(255, 215, 0, 0.9);"><span>今日减少总额:</span><span id="todaySubtractTotal" style="color: #e74c3c; font-weight: bold; margin-left: 5px;">0</span></div></div></div></div></div><div style="background: rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 20px; border: 2px solid rgba(255, 215, 0, 0.3); margin-bottom: 30px; text-align: center;"><h3 style="color: #FFD700; margin-bottom: 10px;"><i class="fas fa-info-circle"></i> 管理面板提示</h3><p style="color: rgba(255, 215, 0, 0.9);"> 所有管理功能已移至右上角的<b style="color: #FFD700;">管理面板</b>中。<br> 点击右上角的"管理面板"按钮展开所有管理功能。 </p></div><div class="user-warehouse-view"><div class="user-warehouse-header"><h3 class="user-warehouse-title"><i class="fas fa-search"></i> 查看用户仓库</h3><div class="user-select-container"><span class="user-select-label">选择用户：</span><select class="user-select" id="userWarehouseSelect"><option value="">请选择用户</option></select></div></div><div id="selectedUserWarehouse" style="display: none;"><h4 style="color: #FFD700; margin-bottom: 15px;"><span id="selectedUserName"></span> 的仓库物品 <span class="warehouse-item-count" id="selectedUserItemCount">0个</span></h4><div class="user-warehouse-items" id="selectedUserWarehouseItems"></div></div></div><div style="margin-bottom: 30px;"><h3 style="margin-bottom: 20px; color: #FFD700;">用户管理</h3><div style="background: rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 20px; border: 2px solid rgba(255, 215, 0, 0.3);"><div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;"><button class="reset-daily-btn admin-panel-control" id="modifyCoinsBtn" style="display: none;"><i class="fas fa-coins"></i> 修改用户金币 </button><button class="reset-daily-btn admin-panel-control" id="approveUsersBtn" style="display: none; background: rgba(46, 204, 113, 0.2); color: #2ecc71; border-color: #2ecc71;"><i class="fas fa-user-check"></i> 审批注册用户 </button><button class="reset-daily-btn admin-panel-control" id="addUserBtn" style="display: none; background: rgba(156, 39, 176, 0.2); color: #9c27b0; border-color: #9c27b0;"><i class="fas fa-user-plus"></i> 创建新用户 </button></div><div class="data-table-wrapper"><table class="data-table"><thead><tr><th>用户名</th><th>邮箱</th><th>角色</th><th>状态</th><th>金币</th><th>操作</th></tr></thead><tbody id="adminUsersTable"></tbody></table></div></div></div><div id="adminItemsSection" style="display: none; margin-bottom: 30px;"><h3 style="margin-bottom: 20px; color: #FFD700;">物品管理</h3><div style="background: rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 20px; border: 2px solid rgba(255, 215, 0, 0.3);"><div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;"><button class="reset-daily-btn admin-panel-control" id="addItemBtn" style="display: none;"><i class="fas fa-plus-circle"></i> 添加新物品 </button><button class="reset-daily-btn admin-panel-control" id="resetAllItemsBtn" style="display: none;"><i class="fas fa-redo"></i> 重置所有物品数量 </button><button class="reset-daily-btn admin-panel-control" id="resetToDefaultBtn" style="display: none; background: rgba(156, 39, 176, 0.2); color: #9c27b0; border-color: #9c27b0;"><i class="fas fa-sync-alt"></i> 重置为默认数量 </button><span style="color: rgba(255, 215, 0, 0.9); font-size: 0.9rem;"> 最后重置: <span id="lastResetDate">无</span></span></div><p style="margin-top: 10px; color: rgba(255, 215, 0, 0.7); font-size: 0.9rem;"><i class="fas fa-info-circle"></i> 物品数量由管理员完全控制，不会自动重置。 </p><div class="data-table-wrapper"><table class="data-table"><thead><tr><th>物品名称</th><th>价值</th><th>稀有度</th><th>概率</th><th>总数量</th><th>剩余</th><th>操作</th></tr></thead><tbody id="adminItemsTable"></tbody></table></div></div></div><div id="adminBoxesSection" style="display: none; margin-bottom: 30px;"><h3 style="margin-bottom: 20px; color: #FFD700;">盲盒管理</h3><div style="background: rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 20px; border: 2px solid rgba(255, 215, 0, 0.3);"><div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;"><button class="reset-daily-btn admin-panel-control" id="resetUnopenedBoxesBtn" style="display: none; background: rgba(255, 193, 7, 0.2); color: #ffc107; border-color: #ffc107;"><i class="fas fa-redo-alt"></i></button><div style="display: flex; gap: 10px; align-items: center;"><input type="number" class="value-reset-input" id="adminTargetValueInput" placeholder="目标价值 (如 4000)" min="0" max="100000" style="max-width: 180px;"><button class="value-reset-btn admin-panel-control" id="adminResetByValueBtn" style="display: none;"><i class="fas fa-calculator"></i></button></div></div><p style="margin-top: 10px; color: rgba(255, 215, 0, 0.7); font-size: 0.9rem;"><i class="fas fa-info-circle"></i> 此操作会重新为所有未开启的盲盒生成新的预设奖品，已开启的盲盒不会受影响。 </p></div></div><div id="adminHistorySection" style="display: none; margin-top: 40px;"><h3 style="margin-bottom: 20px; color: #FFD700;">全局开盒记录</h3><div style="background: rgba(255, 215, 0, 0.1); border-radius: 15px; padding: 20px; border: 2px solid rgba(255, 215, 0, 0.3);"><div style="display: flex; justify-content: space-between; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;"><div><button class="reset-daily-btn admin-panel-control" id="refreshGlobalHistoryBtn" style="display: none;"><i class="fas fa-sync"></i> 刷新记录 </button><button class="reset-daily-btn admin-panel-control" id="clearGlobalHistoryBtn" style="display: none; background: rgba(255, 71, 87, 0.2); color: #ff4757; border-color: #ff4757;"><i class="fas fa-trash"></i> 清空记录 </button></div><div style="color: rgba(255, 215, 0, 0.9);"> 总记录数: <span id="globalHistoryCount">0</span></div></div><div class="data-table-wrapper"><table class="data-table"><thead><tr><th>时间</th><th>中奖人</th><th>物品名称</th><th>物品价值</th><th>稀有度</th><th>盲盒编号</th></tr></thead><tbody id="globalHistoryTableBody"></tbody></table></div></div></div></div></div></div></div><div class="modal" id="resultModal"><div class="result-modal-content"><button class="close-modal" id="closeResultModal">&times;</button><h2 class="result-modal-title"><i class="fas fa-gift"></i> 恭喜获得！</h2><p class="result-modal-subtitle">您从宝藏盒子中获得以下物品</p><div id="resultModalContent"></div><button class="result-modal-close-btn" id="closeResultModalBtn">继续开盲盒</button><p class="result-modal-autoclose" id="resultModalAutoclose">弹窗将在5秒后自动关闭</p></div></div><div class="modal" id="loginModal"><div class="modal-content"><button class="close-modal" id="closeLoginModal">&times;</button><h2 class="modal-title">用户登录</h2><div class="form-group"><label class="form-label">用户名</label><input type="text" class="form-input" id="loginUsername" placeholder="请输入用户名"></div><div class="form-group"><label class="form-label">密码</label><input type="password" class="form-input" id="loginPassword" placeholder="请输入密码"></div><div style="display: flex; gap: 20px; margin-top: 30px;"><button class="form-submit" id="loginBtn" style="flex: 1;">登录</button></div><div style="margin-top: 20px; text-align: center; color: rgba(255, 215, 0, 0.9);"><p>还没有账号？ <a href="#" id="goToRegisterFromLogin" style="color: #FFD700; text-decoration: underline; cursor: pointer;">立即注册</a></p></div></div></div><div class="modal" id="registerModal"><div class="modal-content"><button class="close-modal" id="closeRegisterModal">&times;</button><h2 class="modal-title">用户注册</h2><p style="margin-bottom: 20px; color: rgba(255, 215, 0, 0.9);">注册后需要管理员审批才能登录</p><div class="form-group"><label class="form-label">用户名</label><input type="text" class="form-input" id="registerUsername" placeholder="用户名"></div><div class="form-group"><label class="form-label">密码</label><input type="password" class="form-input" id="registerPassword" placeholder="密码"></div><div class="form-group"><label class="form-label">确认密码</label><input type="password" class="form-input" id="registerPasswordConfirm" placeholder="确认密码"></div><div class="form-group"><label class="form-label">电子邮箱</label><input type="email" class="form-input" id="registerEmail" placeholder="电子邮箱"></div><button class="form-submit" id="registerBtn">提交注册</button><div style="margin-top: 20px; text-align: center; color: rgba(255, 215, 0, 0.9);"><p>已有账号？ <a href="#" id="goToLoginFromRegister" style="color: #FFD700; text-decoration: underline; cursor: pointer;">立即登录</a></p></div></div></div><div class="modal" id="userModal"><div class="modal-content"><button class="close-modal" id="closeUserModal">&times;</button><h2 class="modal-title" id="userModalTitle">创建新用户</h2><div class="form-group"><label class="form-label">用户名</label><input type="text" class="form-input" id="newUsername" placeholder="用户名"></div><div class="form-group"><label class="form-label">初始密码</label><input type="text" class="form-input" id="newPassword" placeholder="初始密码"></div><div class="form-group"><label class="form-label">确认密码</label><input type="text" class="form-input" id="newPasswordConfirm" placeholder="确认密码"></div><div class="form-group"><label class="form-label">电子邮箱</label><input type="email" class="form-input" id="newEmail" placeholder="电子邮箱"></div><div class="form-group"><label class="form-label">初始金币</label><input type="number" class="form-input" id="newBalance" min="0" max="10000" value="0"></div><div class="form-group"><label class="form-label">用户角色</label><select class="form-select" id="newRole"><option value="user">普通用户</option><option value="subadmin">管理员</option><option value="admin">GM</option></select></div><button class="form-submit" id="saveUserBtn">创建用户</button></div></div><div class="modal" id="itemModal"><div class="modal-content"><button class="close-modal" id="closeItemModal">&times;</button><h2 class="modal-title" id="itemModalTitle">添加新物品</h2><div class="form-group"><label class="form-label">物品名称</label><input type="text" class="form-input" id="itemName" placeholder="物品名称"></div><div class="form-group"><label class="form-label">物品图标 (emoji)</label><input type="text" class="form-input" id="itemIcon" placeholder="例如 💰, 🏆, 💎"><p style="margin-top: 5px; color: rgba(255, 215, 0, 0.7); font-size: 0.9rem;"> 如果不使用图片/视频，请填写emoji </p></div><div class="form-group"><label class="form-label">上传图片/视频</label><div class="upload-container"><div class="upload-area" id="uploadArea"><i class="fas fa-cloud-upload-alt"></i><p>点击或拖拽文件到此处上传</p><p class="upload-hint">支持 JPG, PNG, GIF, MP4, WebM (最大 10MB)</p><input type="file" class="form-input" id="itemMedia" accept="image/*,video/*" style="display: none;"></div><div class="upload-controls"><button class="upload-btn" id="uploadBtn"><i class="fas fa-upload"></i> 选择文件 </button><button class="upload-btn remove-btn" id="removeMediaBtn" style="display: none;"><i class="fas fa-trash"></i> 移除 </button></div></div><div class="video-cover-upload" id="videoCoverUpload" style="display: none; margin-top: 15px;"><label class="form-label" style="font-size: 0.95rem;"><i class="fas fa-image"></i> 上传视频封面图片 <span style="color: #e74c3c; font-size: 0.9rem;">* 必需</span></label><div class="upload-container"><div class="upload-area" id="uploadCoverArea"><i class="fas fa-image"></i><p>点击或拖拽图片文件到此处</p><p class="upload-hint">支持 JPG, PNG (最大 5MB)</p><input type="file" class="form-input" id="itemCoverImage" accept="image/*" style="display: none;"></div><div class="upload-controls"><button class="upload-btn" id="uploadCoverBtn"><i class="fas fa-upload"></i> 选择封面图片 </button><button class="upload-btn remove-btn" id="removeCoverBtn" style="display: none;"><i class="fas fa-trash"></i> 移除 </button></div></div><div class="preview-container" id="coverPreviewContainer" style="display: none; margin-top: 10px;"><h4 class="preview-title"><i class="fas fa-eye"></i> 封面预览</h4><div class="preview-content" id="coverPreviewContent"></div></div></div><div class="preview-container" id="previewContainer" style="display: none;"><h4 class="preview-title"><i class="fas fa-eye"></i> 预览</h4><div class="preview-content" id="previewContent"></div></div></div><div class="form-group"><label class="form-label">物品价值 (金币)</label><input type="number" class="form-input" id="itemValue" placeholder="物品价值" value="10" min="1" max="10000"></div><div class="form-group"><label class="form-label">稀有度</label><select class="form-select" id="itemRarity"><option value="common">普通</option><option value="uncommon">稀有</option><option value="rare">珍贵</option><option value="epic">史诗</option><option value="legendary">传说</option></select></div><div class="form-group"><label class="form-label">概率权重 (相对值)</label><input type="number" class="form-input" id="itemChance" placeholder="概率权重" value="1" min="1" max="100"></div><div class="form-group"><label class="form-label">物品总数量</label><input type="number" class="form-input" id="itemTotalLimit" placeholder="物品总数量" value="10" min="0" max="1000"><p style="margin-top: 5px; color: rgba(255, 215, 0, 0.7); font-size: 0.9rem;"> 设置为0表示该物品不可获得。数量不会自动重置。 </p></div><div class="form-group"><label class="form-label">描述</label><textarea class="form-input" id="itemDescription" placeholder="物品描述" rows="3"></textarea></div><button class="form-submit" id="saveItemBtn">保存物品</button></div></div><div class="modal" id="modifyCoinsModal"><div class="modal-content"><button class="close-modal" id="closeModifyCoinsModal">&times;</button><h2 class="modal-title">修改用户金币</h2><div class="form-group"><label class="form-label">选择用户</label><select class="form-select" id="coinsUserSelect"><option value="">请选择用户</option></select></div><div class="form-group"><label class="form-label">操作类型</label><select class="form-select" id="coinsOperation"><option value="add">增加金币</option><option value="subtract">减少金币</option><option value="set">设置为指定值</option></select></div><div class="form-group"><label class="form-label">金币数量</label><input type="number" class="form-input" id="coinsAmount" placeholder="金币数量" max="100000" value="20000"><div class="form-group"><label class="form-label">备注 (可选)</label><input type="text" class="form-input" id="coinsRemark" placeholder="备注信息"></div><button class="form-submit" id="modifyCoinsConfirmBtn">确认修改</button></div></div><div class="modal" id="redeemConfirmModal"><div class="redeem-confirm-modal"><button class="close-modal" id="closeRedeemConfirmModal">&times;</button><h2 class="redeem-confirm-title"><i class="fas fa-coins"></i> 确认兑换</h2><div class="redeem-confirm-details" id="redeemConfirmDetails"></div><div class="redeem-confirm-buttons"><button class="confirm-btn" id="confirmRedeemBtn">确认兑换</button><button class="cancel-btn" id="cancelRedeemBtn">取消</button></div></div></div><div class="modal" id="editBoxItemModal"><div class="modal-content"><button class="close-modal" id="closeEditBoxItemModal">&times;</button><h2 class="modal-title">编辑盲盒奖品</h2><p style="margin-bottom: 20px; color: rgba(255, 215, 0, 0.9);">盲盒编号: <span id="editBoxNumber">0</span></p><div class="form-group"><label class="form-label">当前奖品</label><div id="currentItemInfo" style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px;"></div></div><div class="form-group"><label class="form-label">选择新奖品</label><select class="form-select" id="boxItemSelect"><option value="0">空盒 (无奖品)</option></select></div><div class="form-group"><label class="form-label">新奖品预览</label><div id="newItemPreview" style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; text-align: center;"></div></div><div class="form-group" style="margin-top: 30px;"><button class="form-submit" id="saveBoxItemBtn">更换奖品</button></div></div></div><script src="script.js?v=1.0.0"></script></body></html>